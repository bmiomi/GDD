Server:
  credenciales:
    - default:
        USER: SoporteBZ
        PASSWORD: BZs2026@

    - PRONACA:
        USER: SoporteBz
        PASSWORD: BZs2024**

    - CENACOP:
        USER: SoporteBz
        PASSWORD: BZs2024**

  Consultas:

    REVICION_MADRUGADA:
      sql:
        if: " {{NDISTRIBUIDOR}} == 'PRONACA' "
        then: " SELECT DISTINCT TOP 1
            (SELECT DISTINCT TOP 1 CONVERT(VARCHAR, aptTransactionDate, 103)
            FROM areaproduct WHERE areCode = 'D01') AS preventaQuito,

            (SELECT DISTINCT TOP 1 CONVERT(VARCHAR, aptServerLastUpdate, 103)
            FROM areaproduct WHERE areCode = 'D01') AS DespachoQuito,

            DATEADD(HH, -1,
                (SELECT TOP 1 Trndate
                FROM [TRANSACTION]
                WHERE TRNSCRIPTS LIKE '%CALCULATE%'
                AND TRNSCRIPTS LIKE '%D01%'
                ORDER BY Trndate DESC)
            ) AS INICIOHoraUIO,

            (SELECT TOP 1 trnLastDate
            FROM [TRANSACTION]
            WHERE TRNSCRIPTS LIKE '%CALCULATE%'
            AND TRNSCRIPTS LIKE '%D01%'
            ORDER BY trnLastDate DESC) AS FINHoraUIO,

            (SELECT DISTINCT TOP 1 CONVERT(VARCHAR, aptTransactionDate, 103)
            FROM areaproduct WHERE areCode = 'D02') AS preventaGYE,

            (SELECT DISTINCT TOP 1 CONVERT(VARCHAR, aptServerLastUpdate, 103)
            FROM areaproduct WHERE areCode = 'D02') AS DespachoGYE,

            DATEADD(HH, -1,
                (SELECT TOP 1 Trndate
                FROM [TRANSACTION]
                WHERE TRNSCRIPTS LIKE '%CALCULATE%'
                AND TRNSCRIPTS LIKE '%D02%'
                ORDER BY Trndate DESC)
            ) AS INICIOHORAGYE,

            (SELECT TOP 1 trnLastDate
            FROM [TRANSACTION]
            WHERE TRNSCRIPTS LIKE '%CALCULATE%'
            AND TRNSCRIPTS LIKE '%D02%'
            ORDER BY trnLastDate DESC) AS FINHORAGYE,

            (SELECT DISTINCT TOP 1 CONVERT(VARCHAR, aptTransactionDate, 103)
            FROM areaproduct WHERE areCode = 'D04') AS preventaCuenca,

            (SELECT DISTINCT TOP 1 CONVERT(VARCHAR, aptServerLastUpdate, 103)
            FROM areaproduct WHERE areCode = 'D04') AS DespachoCuenca,

            DATEADD(HH, -1,
                (SELECT TOP 1 Trndate
                FROM [TRANSACTION]
                WHERE TRNSCRIPTS LIKE '%CALCULATE%'
                AND TRNSCRIPTS LIKE '%D04%'
                ORDER BY Trndate DESC)
            ) AS INICIOHORACUENCA,

            (SELECT TOP 1 trnLastDate
            FROM [TRANSACTION]
            WHERE TRNSCRIPTS LIKE '%CALCULATE%'
            AND TRNSCRIPTS LIKE '%D04%'
            ORDER BY trnLastDate DESC) AS FINHORACUENCA,

            (SELECT DISTINCT TOP 1 CONVERT(VARCHAR, aptTransactionDate, 103)
            FROM areaproduct WHERE areCode = 'D05') AS preventaMontecristi,

            (SELECT DISTINCT TOP 1 CONVERT(VARCHAR, aptServerLastUpdate, 103)
            FROM areaproduct WHERE areCode = 'D05') AS DespachoMontecristi,

            DATEADD(HH, -1,
                (SELECT TOP 1 Trndate
                FROM [TRANSACTION]
                WHERE TRNSCRIPTS LIKE '%CALCULATE%'
                AND TRNSCRIPTS LIKE '%D05%'
                ORDER BY Trndate DESC)
            ) AS INICIOHORAMONTEC,

            (SELECT TOP 1 trnLastDate
            FROM [TRANSACTION]
            WHERE TRNSCRIPTS LIKE '%CALCULATE%'
            AND TRNSCRIPTS LIKE '%D05%'
            ORDER BY trnLastDate DESC) AS FINHORAMONTEC,

            (SELECT TOP 1 COUNT(*) FROM customer) AS CUSTOMER_XSS,

            (SELECT TOP 1 COUNT(*) FROM customer WHERE _Deleted = '0') AS CUSTOMER_DELETE_0,

            (SELECT TOP 1 COUNT(DISTINCT cuscode)
            FROM customerroute) AS CUSROUT_TOTAL,

            (SELECT TOP 1 COUNT(DISTINCT cuscode)
            FROM customerroute
            WHERE ctrvisittoday = '1'
            AND rotcode NOT LIKE '%t%') AS CUSROUTE_VISIT_TODAY,

            (SELECT TOP 1 COUNT(*)
            FROM customerstatus
            WHERE cuscode IN (
                SELECT TOP 20000 cusCode
                FROM customerroute
                WHERE ctrVisitToday = '1'
                AND rotcode NOT LIKE '%t%'
            )) AS CUSSTATUS_VISIT_TODAY,

            (SELECT TOP 1 COUNT(*)
            FROM customerstatus
            WHERE cuscode IN (
                SELECT TOP 20000 cusCode
                FROM customerroute
            )) AS CUSSTATUS_TOTAL,

            (SELECT TOP 1 COUNT(*) FROM product WHERE _Deleted = '0') AS PRODUCT,

            (SELECT TOP 1 COUNT(*) FROM CatalogDetail) AS CATALOG,

            (SELECT TOP 1 COUNT(*) FROM promotion) AS PROMOTION,

            (SELECT TOP 1 COUNT(*) FROM promotiondetail) AS PROMOTIOND,

            (SELECT TOP 1 COUNT(*) FROM promotiondetailproduct) AS PROMOTIONDP,

            (SELECT TOP 1 COUNT(*) FROM customerstatus WHERE cusCode LIKE '%199998%') AS GENUIO,

            (SELECT TOP 1 COUNT(*) FROM customerstatus WHERE cusCode LIKE '%299998%') AS GENGYE,

            (SELECT TOP 1 COUNT(*) FROM customerstatus WHERE cusCode LIKE '%488888%') AS GENCUE,

            (SELECT TOP 1 COUNT(*) FROM customerstatus WHERE cusCode LIKE '%588888%') AS GENMON;"

        else: "DECLARE 
          @preventa VARCHAR(25),
          @despacho VARCHAR(25),
          @customerxss INT,
          @cusdelete INT,
          @customerroute INT,
          @cusst INT,
          @customerstatus INT,
          @customerroute1 INT,
          @product INT,
          @promotion INT,
          @promotiond INT,
          @promotiondp INT,
          @generico INT,
          @horainicio DATETIME,
          @horafin DATETIME;
          SELECT TOP 1 
          @preventa = CONVERT(VARCHAR, aptTransactionDate, 103)
          FROM areaproduct
          ORDER BY aptTransactionDate DESC;

          SELECT TOP 1 
              @despacho = CONVERT(VARCHAR, aptServerLastUpdate, 103)
          FROM areaproduct
          ORDER BY aptServerLastUpdate DESC;

          SELECT TOP 1 
              @customerxss = COUNT(*)
          FROM customer;

          SELECT TOP 1 
              @cusdelete = COUNT(*)
          FROM customer
          WHERE _Deleted = '0';

          SELECT TOP 1 
              @customerroute = COUNT(DISTINCT cuscode)
          FROM customerroute
          WHERE ctrvisittoday = '1'
          AND rotcode NOT LIKE '%t%';

          SELECT TOP 1 
              @customerstatus = COUNT(*)
          FROM customerstatus
          WHERE cuscode IN (
              SELECT TOP 100 PERCENT cuscode 
              FROM customerroute
          );

          SELECT TOP 1 
              @cusst = COUNT(*)
          FROM customerstatus
          WHERE cuscode IN (
              SELECT TOP 100 PERCENT cuscode
              FROM customerroute
              WHERE ctrVisitToday = '1'
                AND rotcode NOT LIKE '%t%'
          );

          SELECT TOP 1 
              @customerroute1 = COUNT(DISTINCT cuscode)
          FROM customerroute;

          SELECT TOP 1 
              @product = COUNT(*)
          FROM product
          WHERE _Deleted = '0';

          SELECT TOP 1 
              @promotion = COUNT(*)
          FROM promotion;

          SELECT TOP 1 
              @promotiond = COUNT(*)
          FROM promotiondetail;

          SELECT TOP 1 
              @promotiondp = COUNT(*)
          FROM promotiondetailproduct;

          SELECT TOP 1 
              @generico = COUNT(*)
          FROM customer
          WHERE (
                cusCode LIKE '%099999999%' 
                OR cusCode LIKE '%3030000074%'
                )
          AND cusCode IN (
                SELECT TOP 100 PERCENT cusCode 
                FROM customerstatus
                );

          SELECT TOP 1 
              @horainicio = TrnDate
          FROM [TRANSACTION]
          WHERE TRNSCRIPTS LIKE '%CALCULATE%'
          ORDER BY TrnDate DESC;

          SELECT TOP 1 
              @horafin = trnLastDate
          FROM [TRANSACTION]
          WHERE TRNSCRIPTS LIKE '%CALCULATE%'
          ORDER BY trnLastDate DESC;

          SELECT TOP 1
              DB_NAME() AS DZ_Regional,
              @preventa AS Preventa,
              @despacho AS Despacho,
              DATEADD(HOUR, -1, @horainicio) AS HoraECUInicioStock,
              DATEADD(HOUR, -1, @horafin) AS HoraECUFinStock,
              @customerxss AS CUSTOMER_XSS,
              @cusdelete AS CUSTOMER_DELETE_0,
              @customerroute1 AS CUSROUT_TOTAL,
              @customerroute AS CUSROUTE_VISIT_TODAY,
              @cusst AS CUSSTATUS_VISIT_TODAY,
              @customerstatus AS CUSSTATUS_TOTAL,
              @product AS PRODUCT,
              @promotion AS PROMOTION,
              @promotiond AS PROMOTIOND,
              @promotiondp AS PROMOTIONDP,
              @generico AS GENERICO;"
      parametros_usuario: []
      parametros_sistema:
        - NDISTRIBUIDOR

    DESC.DIURNOS:
      sql:
        if:
        then: >
                "Declare @inicio VARCHAR(255), @fin VARCHAR(255)
                set @inicio = '{{ayer}} 00:00:00.000' set @fin = '{{ayer}} 23:59:00.000'
                Select Top 1000000 LTRIM(RTRIM(Emp_Codigo)) AS Emp_Codigo,
                LTRIM(RTRIM(Id_Negociacion)) AS Id_Negociacion,
                LTRIM(RTRIM(Tipo)) AS Tipo,
                LTRIM(RTRIM(Codigo_Cliente)) AS Codigo_Cliente,
                LTRIM(RTRIM(Dia_Negociacion)) AS Dia_Negociacion,
                LTRIM(RTRIM(Mes_Negociacion)) AS Mes_Negociacion,
                LTRIM(RTRIM(Anio_Negociacion)) AS Anio_Negociacion,
                LTRIM(RTRIM(Cod_Vendedor)) AS Cod_Vendedor,
                LTRIM(RTRIM(Descuento_Negociado)) AS Descuento_Negociado,
                LTRIM(RTRIM(Descuento_Realizado)) AS Descuento_Realizado,
                LTRIM(RTRIM(Descuento_Status)) AS Descuento_Status,
                LTRIM(RTRIM(Desc_Prev_Pedido)) AS Desc_Prev_Pedido,
                LTRIM(RTRIM(Descuento_Procesado_XSales)) AS Descuento_Procesado_XSales,
                LTRIM(RTRIM(Pedido_Realizado)) AS Pedido_Realizado
                from ( select top 1000000 case
                 {{NDISTRIBUIDOR}}
                Else '#' end Emp_Codigo,
                Descu.didCode as Id_Negociacion,
                Descu.Tipo,
                Descu.Cliente as Codigo_Cliente,
                Day(Descu.Fecha) as Dia_Negociacion,
                Month(Descu.Fecha) as Mes_Negociacion,
                Year(Descu.Fecha) as Anio_Negociacion,
                Ruta as Cod_Vendedor, Porcentaje as Descuento_Negociado,
                'Si' as Descuento_Realizado, Descu.Status as Descuento_Status,
                Case When Descu.Fecha< Ped2.Fecha Then'Si' Else'No' End as Desc_Prev_Pedido,Descu.Procesado as Descuento_Procesado_XSales,
                Case When len(Ped2.Fecha)> 4 Then'Si' Else'No' End as Pedido_Realizado From
                (Select  D.didCode,D.cusCode CLIENTE,Convert(Varchar,D.didSystemDate,25) FECHA, D.rotCode RUTA,
                Replace(I.dlpMinDiscount1,',','.') PORCENTAJE,
                Case When (Select A.ApvResponseDetail From Approval A Where A.apvCode=D.apvCode) Like'%RECHAZ%' Then'Rechazado'
                When (Select A.ApvResponseDetail From Approval A Where A.apvCode=D.apvCode) Like'%Respuesta"%:"SI%' ESCAPE':' Then'Aprobado'
                When (Select A.ApvResponseDetail From Approval A Where A.apvCode=D.apvCode) Like'%Respuesta"%:"No%' ESCAPE':' Then'Rechazado'
                When D.ApvCode IS NULL Then'Aprobado'When (Select A.ApvResponseDetail From Approval A Where A.apvCode=D.apvCode) Like'%Respuesta"%:null%' ESCAPE':' Then'Pendiente'
                When (Select A.ApvResponseDetail From Approval A Where A.apvCode=D.apvCode) Like'%Respuesta"%:"EXCEPCION%' ESCAPE':' Then'Pendiente'
                When (Select A.ApvResponseDetail From Approval A Where A.apvCode=D.apvCode) IS NULL Then'Pendiente'END As STATUS,
                Case When D.didProcess='1' Then'Si' Else'No' End As PROCESADO,
                case when apvcode is NULL then'RANGO' else'FUERA RANGO' end as TIPO From DiscountDetailUp D
                Inner Join DiscountDetailProductUp I On D.didCode=I.didCode
                Where D.didCanceled='0' And D.didProcess='1' And D.DidSystemDate Between @inicio And @fin And D.didCode Not In (Select T.didCode From demandTeamProductDiscount T
                Inner Join Demand P On T.dmdCode=P.dmdCode Where P.dmdCancelOrder='1' And P.dmdProcess IS NULL) ) Descu
                Left Join Company On 1=1
                Left Join (Select  D.rotCode, D.cusCode,Max(D.dmdDate) as Fecha From Demand D Left Join DemandProduct DP On D.dmdCode= DP.dmdCode
                Where D.dmdDate Between @inicio And @fin And docCode='ped' and D.rotCode in (Select rotCode From route Where chaCode='V01') And D.dmdCancelOrder= 0 And DP.proCode in (Select proCode From product Where cl4Code='IDGDD001')
                Group By D.rotCode, D.cusCode) Ped2 On Descu.cliente= Ped2.cuscode and Descu.Ruta= Ped2.rotcode
                order by Descu.Ruta ) Todos"
        distribuidores:
          almabi: "When company.comName = 'Almabi' Then '360'"
          alsodi: "When company.comName = 'Alsodi' Then '314'"
          apronam: "When company.comName = 'Apronam' Then '162'"
          cenacop: "When company.comName = 'Cenacop' Then '325'"
          dimmia: "When company.comName = 'Dimmia' Then '111'"
          discarnicos: "When company.comName = 'Discarnicos' Then '261'"
          Disanahisa: "When company.comName = 'Disanahisa' Then '323'"
          disproalza: "When company.comName = 'Disproalza' Then '247'"
          disprovalles: "When company.comName = 'Disprovalles' Then '210'"
          disprolop: "When company.comName = 'Disprolop' Then '331'"
          ecoal: "When company.comName = 'Ecoal' Then '373'"
          grampir: "When company.comName = 'Granpir' Then '234'"
          garvelproduct: "When company.comName = 'Garvel Product' Then '517'"
          h_m: "When company.comName = 'DISTMANA' Then '324'"
          judispro: "When company.comName = 'Judispro' Then '239'"
          madeli: "When company.comName = 'Madeli' Then '128'"
          patricio_cevallos: "When company.comName = 'Patricio_Cevallos' Then '254'"
          paul_florencia: "When company.comName = 'Paul_Florencia' Then '168'"
          posso_cueva: "When company.comName = 'Posso&Cueva' Then '253'"
          prooriente: "When company.comName = 'Prooriente' Then '140'"
          dismag: "When company.comName = 'Dismag' Then '215'"
          pronaca: "When company.comName = 'Pronaca' Then '202'"
          pronacnor: "When company.comName = 'Pronacnor' Then '303'"
          skandinar: "When company.comName = 'Skandinar' Then '121'"
      parametros_usuario: []
      parametros_sistema:
        - ayer
        - NDISTRIBUIDOR

    TOTAL_PEDIDOS:

      sql: >
        select top 100 d.rotcode as Ruta,sum(case when d.dmdCancelOrder='0' and d.doccode='ped' then 1 else 0 end) Pedidos,
            sum(case when dmdCancelOrder='0' and doccode='dev' then 1 else 0 end) 
            Devoluciones,sum(case when dmdCancelOrder='0' and doccode='ped' and dmdprocess='1' then 1 else 0 end)  Pedidos_Procesados,
            sum(case when dmdCancelOrder='0' and doccode='dev' and dmdprocess='1' then 1 else 0 end)  Devoluciones_Procesadas,
            sum(case when dmdCancelOrder='0' and dmdprocess='0' then 1 else 0 end)  Pedidos_No_Procesados,
            sum(case when dmdCancelOrder='0' and dmdprocess='0' then 1 else 0 end)  Devoluciones_No_Procesados,g.gnlStatus as Status,
            g.gnlStatusDate as Fecha,g.gnlPartialStatus as Parcial,g.gnlPartialStatusDate as Parcial_fecha from demand d 
            INNER JOIN general g on d.rotcode= g.rotcode    and day(d.dmddate)={{dia}} and month(d.dmddate)={{mes}} and year(d.dmddate)={{anio}}  
            group by d.rotcode, g.gnlStatus,  g.gnlStatusDate, g.gnlPartialStatus, g.gnlPartialStatusDate
      parametros_usuario:
        - dia
        - mes
        - anio
      parametros_sistema: []

    VALIDAR_CLIENTES:
      sql: "select top 100 _processmessage,cuscode from customerup where cuscode = '{{cuscode}}'"
      parametros_usuario: 
        - cuscode
      parametros_sistema: []

    DESC.NOCTURNOS:
      sql: "select top 1000 cuscode,cusTaxID1,cusName,cusBusinessName from customer where custaxid1 like '%{{valor}}%' "

      parametros_usuario:
        - valor
<<<<<<< HEAD
=======
      parametros_sistema: []
    
    CONSULTARSTATUSRUTAS:
      sql: "select top 100 cr.rotcode from customerroute cr inner join route r on cr.rotcode = r.rotcode inner join customerstatus cs on cr.cuscode = cs.cuscode inner join customer c on cr.cuscode = c.cuscode where cr.rotcode = '{{ROTCODE}}' and cr.ctrvisittoday = '1' and r.chaCode = 'V01'"
      parametros_usuario:
        - ROTCODE
      parametros_sistema: []
>>>>>>> revision
